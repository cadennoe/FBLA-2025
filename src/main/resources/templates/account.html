<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
    
<title>Cade Bank</title>

<link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
	crossorigin="anonymous">

<script>
    $( function() {
	    $( "#datepicker" ).datepicker({ maxDate: 0 });
	    $( "#datepickerstart" ).datepicker();
	    $( "#datepickerend" ).datepicker();
	  } );
	  
    $(document).ready(function() {
        $('input:radio[name=income]').change(function() {
		    $("#category").prop("selectedIndex", 0);
		    document.querySelectorAll("#category option").forEach(opt => {
		    	console.log("opt.value = " + opt.value);
		    	if (opt.value != "" && opt.value != "separator") {
		    	    opt.disabled = !opt.disabled;
		    	}
		    });
		});
	});
</script>

<style>
.header {
	text-align: center;
}

.row {
	display: flex;
	margin: 10px;
}

.columnleft {
	flex: 50%;
	font-size: larger;
}

.columnright {
	flex: 50%;
}

.dropdown {
	width: 193px;
}

input[type=radio] {
  margin-left: 15px;
}
</style>

</head>
    
<body class="body">
	<div class="header">
		<h1>
			<a href="/" style="text-decoration: none; color: black;"> Good Afternoon, Welcome to the Cade Bank </a>
		</h1>
		<h2>
			Current Balance: <strong><span th:text="${#numbers.formatCurrency(money)}" /></strong>
		</h2>
	</div>
	<div class="row">
		<div class="columnleft">
			<h3> Enter a new Income or Expense? </h3>
			<br>
			<form action="#" th:action="@{/add}" th:object="${income}" method="post">
				<table border="2">
					<tr>
						<td colspan="2">
							<input id="incomeradio" type="radio" th:field="*{income}" value="true">
							<label for="incomeradio">Income</label>
							<input id="expenseradio" type="radio" th:field="*{income}" value="false">
							<label for="expenseradio">Expense</label>
							<input type="hidden" th:field="*{id}" />
						</td>
					</tr>
					<tr>
						<th width="200"><label th:text="Amount" /></th>
						<td width="200"><input type="number" th:field="*{amount}" step=".01" min="0.01" required /></td>
					</tr>
					<tr>
						<th><label th:text="Category" /></th>
						<td><select id="category" th:field="*{category}" required class="dropdown">
								<option disabled value="">Please Select One</option>
								<option th:disabled="*{!income}" th:value="'Allowance'"
									th:text="Allowance"></option>
								<option th:disabled="*{!income}" th:value="'Work'"
									th:text="Work"></option>
								<option th:disabled="*{!income}" th:value="'Other Income'"
									th:text="Other"></option>
								<option disabled value="separator">---</option>
								<option th:disabled="*{income}" th:value="'Education'"
									th:text="Education"></option>
								<option th:disabled="*{income}" th:value="'Fees'" th:text="Fees"></option>
								<option th:disabled="*{income}" th:value="'Food'" th:text="Food"></option>
								<option th:disabled="*{income}" th:value="'Groceries'"
									th:text="Groceries"></option>
								<option th:disabled="*{income}" th:value="'Travel'"
									th:text="Travel"></option>
								<option th:disabled="*{income}" th:value="'Other Expense'"
									th:text="Other"></option>
						</select></td>
					</tr>
					<tr>
						<th><label th:text="Date" /></th>
						<td><input type="text" th:field="*{date}" id="datepicker" readonly="true" required /></td>
					</tr>
					<tr>
						<td><input type="submit" th:name="${edit ? 'edit' : 'add' }" th:value="${edit ? 'Edit' : 'Confirm'}" /></td>
						<td th:if="${edit}"><input type="submit" name="cancel" value="Cancel" /></td>
					</tr>
				</table>
			</form>
			<br>
			<h4> Search </h4>
			<br>
			<form action="#" th:action="@{/search}" th:object="${search}" method="post">
				<input type="text" th:field="*{text}" th:value="${search.text}" placeholder="Search" /> 
                <br> 
                <br> 
                <input type="text" th:field="*{start}" id="datepickerstart" readonly="true" placeholder="Start" /> 
                <i class="fa fa-eraser" onclick="document.getElementById('datepickerstart').value = ''"></i>
                
				to
                
                <input type="text" th:field="*{end}" id="datepickerend" readonly="true" placeholder="End" />
                <i class="fa fa-eraser" onclick="document.getElementById('datepickerend').value = ''"></i>
				<br> 
                <br> 
                <input type="submit" value="Search" />
			</form>
			<br>
			<h4> Past Incomes and Expenses </h4>
			<br>
			<form action="#" th:action="@{/filter}" method="post">
				<button type="submit" name="all" value="all"
					th:disabled="${filter == T(org.fbla.caden.model.Filter).ALL}">All</button>
				<button type="submit" name="income" value="income"
					th:disabled="${filter == T(org.fbla.caden.model.Filter).INCOME}">Income</button>
				<button type="submit" name="expense" value="expense"
					th:disabled="${filter == T(org.fbla.caden.model.Filter).EXPENSE}">Expense</button>
			</form>
            <br>
			<table>
				<thead>
					<tr>
						<th>Date</th>
						<th>Amount</th>
						<th>Category</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr th:if="${incomeAndExpenseList.empty}">
						<td colspan="2">N/A</td>
					</tr>
					<tr th:each="line : ${incomeAndExpenseList}">
						<td width="120"><span th:text="${line.date}"> Date </span></td>
						<td width="110"><span th:text="${#numbers.formatCurrency(line.amount)}">
								Amount </span></td>
						<td width="130"><span th:text="${line.category}"> Category </span></td>
						<td><a th:href="@{/edit/{id}(id=${line.id})}"><i
								class="fa fa-pencil fa-lg"></i></a> <a
							th:href="@{/delete/{id}(id=${line.id})}"><i
								class="fa fa-trash-o fa-lg"></i></a></td>
					</tr>
				</tbody>
			</table>
		</div>

		<div class="columnright">
			<canvas id="expenseCategoryChart" style="width: 100%; max-width: 600px"></canvas>

			<script th:inline="javascript">
var xValues = ["Education", "Fees", "Food", "Groceries", "Travel", "Other"];
var yValues = [[${expenseCategoryData}]];
var barColors = ["red", "orange","yellow","green","blue", "purple"];


                
new Chart("expenseCategoryChart", {
  type: "bar",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: barColors,
      data: yValues
    }]
  },
  options: {
	  scales: {
	        yAxes: [{
	            ticks: {
	                beginAtZero: true
	            }
	        }]
	    },
    legend: {display: false},
    title: {
      display: true,
      text: "Expenses by Category"
    }
  }
});
</script>



			<canvas id="incomeCategoryChart"
				style="width: 100%; max-width: 600px"></canvas>

			<script th:inline="javascript">
var xValues = ["Allowance", "Work", "Other"];
var yValues = [[${incomeCategoryData}]];
var barColors = ["red", "green","blue"];

new Chart("incomeCategoryChart", {
  type: "bar",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: barColors,
      data: yValues
    }]
  },
  options: {
	  scales: {
	        yAxes: [{
	            ticks: {
	                beginAtZero: true
	            }
	        }]
	    },
    legend: {display: false},
    title: {
      display: true,
      text: "Incomes by Category"
    }
  }
});
</script>



			<canvas id="lastSixMonthChart" style="width: 100%; max-width: 600px"></canvas>

			<script th:inline="javascript">
var xValues = ["October", "November", "December", "Janurary", "Feburary", "March"];
var yValues = [[${lastSixMonthData}]];
var barColors = ["red", "orange","yellow", "green", "blue", "purple"];

new Chart("lastSixMonthChart", {
  type: "bar",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: barColors,
      data: yValues
    }]
  },
  options: {
	  scales: {
	        yAxes: [{
	            ticks: {
	                beginAtZero: true
	            }
	        }]
	    },
    legend: {display: false},
    title: {
      display: true,
      text: "Incomes and Expenses of the last six months"
    }
  }
});
</script>



			<canvas id="lastFourWeekChart" style="width: 100%; max-width: 600px"></canvas>

			<script th:inline="javascript">
var xValues = ["Four Weeks Ago", "Three Weeks Ago", "Last Week", "This Week"];
var yValues = [[${lastFourWeekData}]];
var barColors = ["red","yellow", "green", "blue"];

new Chart("lastFourWeekChart", {
  type: "bar",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: barColors,
      data: yValues
    }]
  },
  options: {
	  scales: {
	        yAxes: [{
	            ticks: {
	                beginAtZero: true
	            }
	        }]
	    },
    legend: {display: false},
    title: {
      display: true,
      text: "Incomes and Expenses of the last four weeks"
    }
  }
});
</script>
<a th:href="@{/demo}">demo</a>
		</div>
	</div>
</body>
</html>